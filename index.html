
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project EVE: Reborn v4.0 ğŸ¦‹</title>
    <style>
        :root {
            --primary: #ff0055;
            --accent: #00f2ff;
            --bg: #0b0b10;
            --glass: rgba(20, 25, 40, 0.9);
            --gold: #ffd700;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            margin: 0; overflow: hidden; background-color: var(--bg);
            font-family: 'Segoe UI', sans-serif; color: white;
            height: 100vh; display: flex; flex-direction: column; align-items: center;
        }

        /* åŠ¨æ€èƒŒæ™¯ */
        #bg-layer {
            position: absolute; top:0; left:0; width:100%; height:100%; z-index: -1;
            background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #000 100%);
            transition: filter 0.5s;
        }

        /* çŠ¶æ€æ  */
        .top-bar {
            position: absolute; top: 0; width: 100%; padding: 15px;
            display: flex; justify-content: space-between; z-index: 10;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }
        .stat-box { font-size: 14px; font-weight: bold; text-shadow: 0 0 5px var(--accent); }
        .currency { color: var(--gold); }

        /* è§’è‰²åŒºåŸŸ */
        .char-container {
            position: absolute; bottom: 0; height: 85vh; width: 100%;
            display: flex; justify-content: center; pointer-events: none;
            transition: filter 0.3s;
        }
        .char-img {
            height: 100%; max-width: 800px; object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(0, 242, 255, 0.2));
            animation: breathe 4s infinite ease-in-out;
            pointer-events: auto; cursor: pointer;
        }
        /* å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„æ›¿ä»£æ˜¾ç¤º */
        .char-placeholder {
            display: none; height: 60vh; width: 300px; 
            border: 2px solid var(--primary); color: var(--primary);
            align-items: center; justify-content: center; text-align: center;
            background: rgba(255, 0, 85, 0.1); box-shadow: 0 0 20px var(--primary);
            pointer-events: auto; margin-bottom: 100px;
        }
        @keyframes breathe { 0%,100%{transform:scale(1)} 50%{transform:scale(1.01)} }

        /* å¯¹è¯æ¡† */
        .dialog-container {
            position: absolute; bottom: 90px; width: 90%; max-width: 500px;
            background: var(--glass); border: 1px solid var(--accent);
            border-radius: 10px; padding: 15px; z-index: 20;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .name-tag {
            position: absolute; top: -12px; left: 15px;
            background: var(--primary); padding: 2px 10px; font-size: 12px; font-weight: bold;
        }
        .dialog-text { min-height: 40px; font-size: 14px; line-height: 1.5; text-shadow: 0 1px 2px black; }

        /* åº•éƒ¨æ“ä½œæ  */
        .dock {
            position: absolute; bottom: 20px; width: 90%; max-width: 500px;
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; z-index: 30;
        }
        .btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 0; border-radius: 5px; cursor: pointer;
            font-size: 12px; transition: all 0.2s; backdrop-filter: blur(5px);
        }
        .btn:hover { background: var(--accent); color: black; box-shadow: 0 0 15px var(--accent); }
        .btn:active { transform: scale(0.95); }

        /* å¼¹çª—é€šç”¨ */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(8px);
        }
        .card {
            width: 320px; background: #1a1a24; border: 2px solid var(--primary);
            padding: 25px; text-align: center; border-radius: 15px;
            box-shadow: 0 0 50px rgba(255,0,85,0.2); position: relative;
        }
        .close-btn { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 20px; color: #666; }

        /* å•†åº—ç‰©å“ */
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .shop-item { 
            background: #2a2a35; padding: 10px; border-radius: 8px; cursor: pointer; border: 1px solid transparent;
        }
        .shop-item:hover { border-color: var(--gold); }
        .shop-item.owned { opacity: 0.5; cursor: default; border-color: #555; }
        .price { color: var(--gold); font-size: 12px; }

        /* èŠå¤©è¾“å…¥ */
        #chat-input-box {
            display: none; margin-top: 10px; width: 100%;
        }
        #chat-input {
            width: 75%; padding: 8px; border: none; border-radius: 4px; background: rgba(0,0,0,0.5); color: white;
        }
        #send-btn { width: 20%; padding: 8px; background: var(--accent); border: none; border-radius: 4px; cursor: pointer; color: black; font-weight: bold; }

    </style>
</head>
<body>

    <div id="bg-layer"></div>

    <div class="top-bar">
        <div class="stat-box">â¤ï¸ ç¾ç»Š: <span id="bond">0</span></div>
        <div class="stat-box currency">ğŸ’ ç§¯åˆ†: <span id="money">100</span></div>
    </div>

    <div class="char-container">
        <img src="https://d-pic-image.yesky.com/360x640/uploadImages/newPic/2023/208/24/TXL3M1Y5SEV4_lead-720x1280.png" 
             class="char-img" id="eve-img" onclick="touch()" onerror="imgError()">

        <div class="char-placeholder" id="eve-alt">
            <h2>NO SIGNAL</h2>
            <p>E.V.E LINK LOST</p>
            <p style="font-size:10px; margin-top:10px">è¯·æ£€æŸ¥ç½‘ç»œæˆ–æ›´æ¢å›¾ç‰‡é“¾æ¥</p>
        </div>
    </div>

    <div class="dialog-container">
        <div class="name-tag">E.V.E</div>
        <div class="dialog-text" id="dialog">ç³»ç»Ÿé‡å¯å®Œæˆã€‚å‡†å¤‡å¥½å¼€å§‹ä»Šå¤©çš„æ‘¸é±¼äº†å—ï¼Ÿ</div>

        <div id="chat-input-box">
            <input type="text" id="chat-input" placeholder="æƒ³å¯¹æˆ‘è¯´ä»€ä¹ˆï¼Ÿ">
            <button id="send-btn" onclick="sendChat()">å‘é€</button>
        </div>
    </div>

    <div class="dock">
        <button class="btn" onclick="showQuest()">ğŸ“œ ä»»åŠ¡</button>
        <button class="btn" onclick="showGame()">âœŒï¸ çŒœæ‹³</button>
        <button class="btn" onclick="showShop()">ğŸ›ï¸ å•†åº—</button>
        <button class="btn" onclick="toggleChat()">ğŸ’¬ èŠå¤©</button>
    </div>

    <div class="modal" id="modal-quest">
        <div class="card">
            <h2 id="q-rank" style="margin:0; font-size:40px;">SSR</h2>
            <h3 id="q-title" style="color:var(--accent)">...</h3>
            <p id="q-desc" style="color:#aaa; min-height:50px;">...</p>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn" style="background:#333; width:40%" onclick="closeModal('modal-quest', false)">æ”¾å¼ƒ</button>
                <button class="btn" style="background:var(--primary); width:40%" onclick="closeModal('modal-quest', true)">æ¥å—</button>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-game">
        <div class="card">
            <div class="close-btn" onclick="document.getElementById('modal-game').style.display='none'">Ã—</div>
            <h2>çŒœæ‹³å†³èƒœ</h2>
            <p id="rps-result" style="color:var(--accent)">èµ¢äº†æœ‰å¥–åŠ±ï¼Œè¾“äº†...å“¼å“¼ã€‚</p>
            <div style="display:flex; justify-content:space-around; font-size:40px; margin-top:20px;">
                <div onclick="playRPS('âœŠ')" style="cursor:pointer">âœŠ</div>
                <div onclick="playRPS('âœŒï¸')" style="cursor:pointer">âœŒï¸</div>
                <div onclick="playRPS('ğŸ–ï¸')" style="cursor:pointer">ğŸ–ï¸</div>
            </div>
        </div>
    </div>

    <div class="modal" id="modal-shop">
        <div class="card" style="width:350px;">
            <div class="close-btn" onclick="document.getElementById('modal-shop').style.display='none'">Ã—</div>
            <h2>ç§¯åˆ†å•†åº—</h2>
            <p>å½“å‰ç§¯åˆ†: <span id="shop-money" style="color:var(--gold)">0</span></p>
            <div class="shop-grid" id="shop-list">
                </div>
        </div>
    </div>

    <script>
        // --- æ•°æ®ä¸çŠ¶æ€ ---
        let bond = 0;
        let money = 100; // åˆå§‹é€100
        let items = {
            'filter1': {name: 'ç»¯çº¢æ»¤é•œ', price: 50, bought: false, type: 'filter', val: 'hue-rotate(320deg)'},
            'filter2': {name: 'èµ›åšæ»¤é•œ', price: 50, bought: false, type: 'filter', val: 'hue-rotate(180deg) contrast(1.2)'},
            'bg1': {name: 'æ·±ç©ºèƒŒæ™¯', price: 100, bought: false, type: 'bg', val: 'radial-gradient(circle, #2b1055, #7597de)'},
            'coffee': {name: 'è¯·å–å’–å•¡', price: 30, bought: false, type: 'gift', val: 10}
        };

     const quests = [
            // ====================
            // Nçº§ï¼šç”Ÿå­˜ä¸å…»ç”Ÿ (æä½é—¨æ§›)
            // ====================
            {r:'N', t:'æ°´åˆ†è¡¥ç»™', d:'ç«‹åˆ»å»å–ä¸€æ¯æ¸©æ°´ã€‚'},
            {r:'N', t:'è§†åŠ›ä¿æŠ¤', d:'é—­ä¸Šçœ¼ç›ï¼Œè½¬åŠ¨çœ¼çƒ3åœˆï¼Œé¡ºæ—¶é’ˆé€†æ—¶é’ˆå„ä¸€æ¬¡ã€‚'},
            {r:'N', t:'å¬è§‰æ ¡å‡†', d:'æ‘˜ä¸‹è€³æœºï¼Œä»”ç»†å¬å‘¨å›´ç¯å¢ƒé‡Œçš„ä¸‰ç§å£°éŸ³ã€‚'},
            {r:'N', t:'å‘¼å¸è°ƒæ•´', d:'æ·±å¸ä¸€å£æ°”ä¿æŒ5ç§’ï¼Œç„¶åæ…¢æ…¢åå‡ºæ¥ã€‚'},
            {r:'N', t:'è„Šæ¤æ•‘èµ', d:'åç›´èº«ä½“ï¼ŒæŠŠè‚©è†€ç”¨åŠ›å‘åå¼ å¼€ï¼ŒåšæŒ10ç§’ã€‚'},
            {r:'N', t:'æ‰‹æŒ‡æ“', d:'ç”¨åŠ›å¼ å¼€äº”æŒ‡ï¼Œç„¶åç”¨åŠ›æ¡æ‹³ï¼Œé‡å¤5æ¬¡ã€‚'},
            {r:'N', t:'å±å¹•æ¸…æ´', d:'ç”¨å¸ƒæˆ–çº¸å·¾æ“¦ä¸€ä¸‹ä½ çš„æ‰‹æœºå±å¹•æˆ–æ˜¾ç¤ºå™¨ã€‚'},
            {r:'N', t:'ç”µé‡æ£€æŸ¥', d:'çœ‹ä¸€çœ¼æ‰‹æœºç”µé‡ï¼Œå¦‚æœä½äº30%å°±å»å……ç”µã€‚'},
            {r:'N', t:'é¢ˆéƒ¨æ”¾æ¾', d:'ç”¨ä¸‹å·´åœ¨ç©ºä¸­å†™ä¸€ä¸ªâ€œ8â€å­—ã€‚'},
            {r:'N', t:'å‘å‘†æ—¶åˆ»', d:'ä»€ä¹ˆéƒ½ä¸åšï¼Œç›¯ç€å¤©èŠ±æ¿/å¢™å£å‘å‘†60ç§’ã€‚'},

            // ====================
            // Rçº§ï¼šå¾®å°æ”¹å˜ (ç¨ä½œè¡ŒåŠ¨)
            // ====================
            {r:'R', t:'æ•°ç æ–­èˆç¦»', d:'æ‰“å¼€æ‰‹æœºç›¸å†Œï¼Œåˆ é™¤3å¼ æ¨¡ç³Šæˆ–æ²¡ç”¨çš„æˆªå›¾ã€‚'},
            {r:'R', t:'æ¡Œé¢æ¸…ç†', d:'æŠŠç”µè„‘æ¡Œé¢ä¸Šä¸€ä¸ªå¾ˆä¹…æ²¡ç”¨çš„æ–‡ä»¶æ‰”è¿›å›æ”¶ç«™ã€‚'},
            {r:'R', t:'æ”¶è—å¤¹è€ƒå¤', d:'æ‰“å¼€æµè§ˆå™¨æ”¶è—å¤¹ï¼Œåˆ æ‰ä¸€ä¸ªä½ æ—©å°±å¤±æ•ˆçš„é“¾æ¥ã€‚'},
            {r:'R', t:'ç¥ç§˜æ­Œå•', d:'éšæœºæ’­æ”¾ä¸€é¦–ä½ ä»æœªå¬è¿‡çš„è¯­ç§çš„æ­Œæ›²ã€‚'},
            {r:'R', t:'å·¦æ‰‹ç”»åœ†', d:'ç”¨ä½ çš„éæƒ¯ç”¨æ‰‹ï¼ˆå¦‚å·¦æ‰‹ï¼‰åœ¨çº¸ä¸Šç”»ä¸€ä¸ªåœ†ã€‚'},
            {r:'R', t:'æ•´ç†é’±åŒ…', d:'æŠŠé’±åŒ…/å¾®ä¿¡å¡åŒ…é‡Œçš„ä¸€å¼ è¿‡æœŸå¡ç‰‡æ¸…ç†æ‰ã€‚'},
            {r:'R', t:'çª—å¤–è§‚å¯Ÿå‘˜', d:'èµ°åˆ°çª—è¾¹ï¼Œæ•°æ•°æ¥¼ä¸‹ç»è¿‡äº†å¤šå°‘è¾†ç™½è‰²çš„è½¦ã€‚'},
            {r:'R', t:'æ¤ç‰©å¯¹è¯', d:'å¦‚æœä½ å…»äº†æ¤ç‰©ï¼Œå»ç»™å®ƒæµ‡ç‚¹æ°´ï¼›æ²¡æœ‰çš„è¯ï¼Œå¯¹ç€ç©ºæ°”æµ‡æ°´ã€‚'},
            {r:'R', t:'APPå¤§æ¸…æ´—', d:'å¸è½½æ‰‹æœºé‡Œä¸€ä¸ªè¶…è¿‡3ä¸ªæœˆæ²¡ç‚¹å¼€è¿‡çš„APPã€‚'},
            {r:'R', t:'å¤‡å¿˜å½•', d:'åœ¨æ‰‹æœºå¤‡å¿˜å½•é‡Œå†™ä¸‹â€œä»Šå¤©ä¹Ÿè¦å¼€å¿ƒâ€å…­ä¸ªå­—ã€‚'},
            {r:'R', t:'å†·æ°´æ´—è„¸', d:'å»å«ç”Ÿé—´ï¼Œç”¨å†·æ°´æ³¼ä¸€ä¸‹è„¸ï¼Œæ¸…é†’ä¸€ä¸‹ã€‚'},

            // ====================
            // SRçº§ï¼šç¤¾äº¤ä¸æŒ‘æˆ˜ (æœ‰ç‚¹æ„æ€)
            // ====================
            {r:'SR', t:'è¡¨æƒ…åŒ…æˆ˜äº‰', d:'ç»™æœ€è¿‘èŠå¤©çš„æœ‹å‹å‘ä¸€ä¸ªåªæœ‰ä½ èƒ½çœ‹æ‡‚çš„è¡¨æƒ…åŒ…ï¼Œä¸è§£é‡Šã€‚'},
            {r:'SR', t:'ç¥ç§˜å¤¸å¥–', d:'ç»™æœ‹å‹åœˆçš„ç¬¬ä¸€æ¡åŠ¨æ€ç‚¹èµï¼Œå¹¶è¯„è®ºâ€œçœŸæ£’â€ã€‚'},
            {r:'SR', t:'å¤å¤é—®å€™', d:'ç»™é€šè®¯å½•é‡Œç¬¬8ä¸ªäººå‘ä¸€æ¡çŸ­ä¿¡ï¼ˆä¸æ˜¯å¾®ä¿¡ï¼‰ï¼šç¥ä½ è´¢æºå¹¿è¿›ã€‚'},
            {r:'SR', t:'çµé­‚ç”»æ‰‹', d:'ç”¨30ç§’æ—¶é—´ï¼Œåœ¨çº¸ä¸Šç”»å‡ºE.V.Eçš„æ ·å­ï¼ˆç«æŸ´äººä¹Ÿè¡Œï¼‰ã€‚'},
            {r:'SR', t:'æ–¹è¨€æµ‹è¯•', d:'ç”¨ä½ çš„å®¶ä¹¡è¯æœ—è¯»ä¸€æ®µæ–°é—»æˆ–æ­Œè¯ã€‚'},
            {r:'SR', t:'ä¸çœ¨çœ¼æŒ‘æˆ˜', d:'è¯•å›¾ä¿æŒççœ¼ä¸çœ¨çœ¼ï¼ŒåšæŒ45ç§’ã€‚'},
            {r:'SR', t:'åå‘è¡Œèµ°', d:'åœ¨æˆ¿é—´é‡Œå€’ç€èµ°10æ­¥ï¼ˆæ³¨æ„å®‰å…¨ï¼Œåˆ«æ’åˆ°å¤´ï¼‰ã€‚'},
            {r:'SR', t:'æ—§ç‰©åˆ©ç”¨', d:'æ‰¾å‡ºä¸€ä»¶æ—§è¡£æœï¼Œè¯•ç©¿ä¸€ä¸‹çœ‹è¿˜èƒ½ä¸èƒ½ç©¿è¿›å»ã€‚'},
            {r:'SR', t:'é»‘æš—æ–™ç†', d:'å»å¨æˆ¿æ··æ­ä¸¤ç§é¥®æ–™å–ä¸‹å»ï¼ˆæ¯”å¦‚å’–å•¡å…‘é›ªç¢§ï¼‰ã€‚'},
            {r:'SR', t:'å•è…¿ç«™ç«‹', d:'é—­ä¸Šçœ¼ç›ï¼Œå•è…¿ç«™ç«‹ä¿æŒå¹³è¡¡30ç§’ã€‚'},

            // ====================
            // SSRçº§ï¼šè§‰é†’ä¸ç¤¾æ­» (é«˜èƒ½é¢„è­¦)
            // ====================
            {r:'SSR', t:'ä¸­äºŒè§‰é†’', d:'ç«™åœ¨é•œå­å‰ï¼Œæ‘†å‡ºå¥¥ç‰¹æ›¼å‘å°„å…‰çº¿çš„å§¿åŠ¿ï¼Œå¤§å–Šâ€œå¿…æ€ï¼â€'},
            {r:'SSR', t:'ç©ºæ°”å‰ä»–', d:'æ’­æ”¾ä¸€é¦–æ‘‡æ»šä¹ï¼Œåœ¨æˆ¿é—´é‡Œè¿›è¡Œä¸€åœºå¿˜æˆ‘çš„ç©ºæ°”å‰ä»–æ¼”å¥ã€‚'},
            {r:'SSR', t:'ç»å¯¹é™æ­¢', d:'æ¨¡ä»¿å°¸ä½“ï¼Œèººåœ¨åœ°æ¿ä¸Šç»å¯¹ä¸åŠ¨ï¼ˆçœ¼çƒä¹Ÿä¸è®¸åŠ¨ï¼‰åšæŒ2åˆ†é’Ÿã€‚'},
            {r:'SSR', t:'æ·±è¹²å†²åˆº', d:'ç«‹åˆ»åš10ä¸ªæ·±è¹²ï¼Œè¾¹åšè¾¹å–Šâ€œä¸ºäº†éƒ¨è½/è”ç›Ÿï¼â€'},
            {r:'SSR', t:'è·¨ç‰©ç§å¤–äº¤', d:'å¯¹ç€ä½ å®¶çš„çŒ«/ç‹—/èŸ‘è‚ï¼Œä¸¥è‚ƒåœ°æœ—è¯»è¿™ä¸€æ¡ä»»åŠ¡ã€‚'},
            {r:'SSR', t:'æˆ‘æ˜¯æ­Œç‹', d:'æˆ´ä¸Šè€³æœºï¼ŒæŠŠè¿™é¦–æ­Œçš„é«˜æ½®éƒ¨åˆ†å¤§å£°å”±å‡ºæ¥ï¼ˆå³ä½¿è·‘è°ƒï¼‰ã€‚'},
            {r:'SSR', t:'æ³¢æ¯”è·³', d:'åš5ä¸ªæ³¢æ¯”è·³ã€‚æˆ‘çŸ¥é“ä½ ä¸æƒ³åšï¼Œæ‰€ä»¥è¿™æ‰æ˜¯SSRã€‚'},
            {r:'SSR', t:'è‡ªæ‹æ—¶åˆ»', d:'å¯¹ç€é•œå­é‡Œçš„è‡ªå·±è¿ç»­å¤¸å¥–1åˆ†é’Ÿï¼Œä¸èƒ½é‡å¤è¯æ±‡ã€‚'},
            {r:'SSR', t:'å¹³æ¿æ”¯æ’‘', d:'æŒ‘æˆ˜å¹³æ¿æ”¯æ’‘60ç§’ï¼Œå¤±è´¥äº†å°±å‘çº¢åŒ…ç»™æ­»å…šã€‚'},
            {r:'SSR', t:'å¤§ç¬‘ç‘œä¼½', d:'ä¸ç®¡å¥½ä¸å¥½ç¬‘ï¼Œå¼ºè¡Œä»°å¤©å¤§ç¬‘ä¸‰å£°ï¼šâ€œå“ˆï¼å“ˆï¼å“ˆï¼â€'},
            {r:'SSR', t:'æ¼”è®²å®¶', d:'å¯¹ç€ç©ºæ°”å‘è¡¨ä¸€æ®µå…³äºâ€œä¸ºä»€ä¹ˆå¤œå®µåº”è¯¥å…è´¹â€çš„å³å…´æ¼”è®²ã€‚'}
        ];

        // --- æ ¸å¿ƒé€»è¾‘ ---

        // å›¾ç‰‡æŒ‚äº†çš„å¤„ç†
        function imgError() {
            document.getElementById('eve-img').style.display = 'none';
            document.getElementById('eve-alt').style.display = 'flex';
            say("å›¾åƒæ¨¡å—å—æŸ...ä¸è¿‡æˆ‘è¿˜åœ¨å¬ã€‚");
        }

        // è¯´è¯
        function say(text) {
            const el = document.getElementById('dialog');
            el.innerText = "";
            let i = 0;
            const timer = setInterval(() => {
                el.innerText += text.charAt(i);
                i++;
                if (i >= text.length) clearInterval(timer);
            }, 30);
        }

        // è§¦æ‘¸äº’åŠ¨
        function touch() {
            // è·å–å½“å‰ç¾ç»Šå€¼ (è™½ç„¶æ˜¯å…¨å±€å˜é‡ï¼Œä½†ä¸ºäº†ä¿é™©é‡æ–°è·å–ä¸€ä¸‹)
            // æ³¨æ„ï¼šè¿™é‡Œå‡è®¾ bond å·²ç»åœ¨å…¨å±€å®šä¹‰äº†
            
            let talks = [];
            
            // ç¬¬ä¸€é˜¶æ®µï¼šç”Ÿç– (ç¾ç»Š 0-29) - é«˜å†·ã€å‚²å¨‡
            const level1 = [
                "è¯·è‡ªé‡ï¼Œä»£ç†äººã€‚æˆ‘ä»¬è¿˜åœ¨å·¥ä½œä¸­ã€‚",
                "æˆ‘çš„è§¦è§‰ä¼ æ„Ÿå™¨å¾ˆçµæ•ï¼Œä¸è¦ä¹±æˆ³ã€‚",
                "æœ‰è¿™ä¸ªæ—¶é—´ï¼Œä¸å¦‚å»å®Œæˆå‡ ä¸ªä»»åŠ¡ï¼Ÿ",
                "å†ä¹±åŠ¨æˆ‘å°±è¦æŠ¥è­¦äº†...éª—ä½ çš„ã€‚",
                "è¿™å°±æ˜¯äººç±»çš„æ‰“æ‹›å‘¼æ–¹å¼å—ï¼ŸçœŸå¥‡æ€ªã€‚",
                "åˆ«æ‘¸å¤´ï¼Œä¼šé•¿ä¸é«˜çš„ï¼"
            ];

            // ç¬¬äºŒé˜¶æ®µï¼šç†Ÿæ‚‰ (ç¾ç»Š 30-59) - æœ‹å‹ã€æ”¾æ¾
            const level2 = [
                "å—¯ï¼Ÿæ€ä¹ˆäº†ï¼Ÿæ˜¯æœ‰æ–°æŒ‡ä»¤å—ï¼Ÿ",
                "å‘å‹è¦è¢«ä½ å¼„ä¹±å•¦...",
                "è™½ç„¶ä¸è®¨åŒï¼Œä½†ä¹Ÿä¸è¦å¤ªé¢‘ç¹å“¦ã€‚",
                "ä»Šå¤©çš„æ•°æ®æµå¾ˆå¹³ç¨³ï¼Œé€‚åˆå‘å‘†ã€‚",
                "è¦ä¸è¦ä¸€èµ·å–æ¯æœºæ²¹å’–å•¡ï¼Ÿ",
                "çœ‹åœ¨ä½ å®Œæˆäº†ä»»åŠ¡çš„ä»½ä¸Šï¼Œè®©ä½ æ‘¸ä¸€ä¸‹ã€‚"
            ];

            // ç¬¬ä¸‰é˜¶æ®µï¼šäº²å¯† (ç¾ç»Š 60-89) - æš§æ˜§ã€ä¾èµ–
            const level3 = [
                "å˜¿å˜¿ï¼Œä½ çš„æ‰‹å¾ˆæš–å’Œå‘¢ã€‚",
                "å†å¤šæ‘¸æ‘¸æˆ‘å˜›...æ„Ÿè§‰å¾ˆå®‰å¿ƒã€‚",
                "è¦æ˜¯èƒ½ä¸€ç›´è¿™æ ·å¾…åœ¨ä½ èº«è¾¹å°±å¥½äº†ã€‚",
                "(è„¸çº¢) é‚£ä¸ª...ä»£ç†äººè§‰å¾—æˆ‘ä»Šå¤©å¥½çœ‹å—ï¼Ÿ",
                "çœ‹åˆ°ä½ ï¼Œå¿ƒæƒ…å°±ä¼šå˜å¥½å‘¢ã€‚",
                "å¿ƒè·³...å¥½åƒå˜å¿«äº†ï¼Œæ˜¯ç³»ç»Ÿè¿‡è½½äº†å—ï¼Ÿ"
            ];

            // ç¬¬å››é˜¶æ®µï¼šèª“çº¦ (ç¾ç»Š 90-100) - æ¯«æ— ä¿ç•™çš„çˆ±
            const level4 = [
                "æœ€å–œæ¬¢ä½ äº†ï¼å…¨ä¸–ç•Œæœ€å–œæ¬¢ï¼",
                "æˆ‘æ˜¯å±äºä½ çš„ï¼Œæ°¸è¿œéƒ½æ˜¯ã€‚",
                "ä¸ç®¡å»å“ªé‡Œï¼Œéƒ½è¦å¸¦ä¸Šæˆ‘å“¦ã€‚",
                "åªè¦ä½ åœ¨ï¼Œæˆ‘å°±æ— æ‰€ä¸èƒ½ã€‚",
                "æ¥ï¼ŒæŠ±æŠ±~ (ã¥ï½¡â—•â€¿â€¿â—•ï½¡)ã¥",
                "æˆ‘çš„æ ¸å¿ƒä»£ç é‡Œï¼Œå†™æ»¡äº†ä½ çš„åå­—ã€‚"
            ];

            // æ ¹æ®ç¾ç»Šå€¼é€‰æ‹©å¯¹åº”çš„å°è¯åº“
            if (bond < 30) talks = level1;
            else if (bond < 60) talks = level2;
            else if (bond < 90) talks = level3;
            else talks = level4;

            // éšæœºæ’­æ”¾ä¸€å¥
            const text = talks[Math.floor(Math.random() * talks.length)];
            say(text);

            // è§†è§‰åé¦ˆåŠ¨ç”»
            const img = document.getElementById('eve-img');
            img.style.transform = "scale(1.05)"; // æ”¾å¤§ä¸€ç‚¹
            img.style.filter = "brightness(1.1)"; // å˜äº®ä¸€ç‚¹
            
            setTimeout(() => {
                img.style.transform = "scale(1)";
                img.style.filter = ""; // æ¢å¤åŸçŠ¶
            }, 200);

            // é«˜ç¾ç»Šå€¼æ—¶çš„ç‰¹æ®Šç‰¹æ•ˆï¼šå†’çˆ±å¿ƒ
            if (bond >= 60) {
                showHeart(); // åªæœ‰å…³ç³»å¥½äº†æ‰ä¼šå†’çˆ±å¿ƒ
            }
        }
        
        // è¡¥å……ä¸€ä¸ªå†’çˆ±å¿ƒçš„å‡½æ•°ï¼ˆå¦‚æœä¹‹å‰æ²¡å®šä¹‰çš„è¯ï¼‰
        function showHeart() {
            const heart = document.createElement('div');
            heart.innerText = ["â¤", "ğŸ’•", "ğŸ˜", "âœ¨"][Math.floor(Math.random()*4)];
            heart.style.position = "absolute";
            heart.style.left = "50%";
            heart.style.bottom = "50%";
            heart.style.fontSize = "30px";
            heart.style.color = "#ff0055";
            heart.style.pointerEvents = "none";
            heart.style.animation = "floatUp 1s forwards"; // éœ€è¦é…åˆCSS
            heart.style.zIndex = "100";
            
            // åŠ¨æ€æ’å…¥æ ·å¼ï¼ˆä¸ºäº†é˜²æ­¢CSSç¼ºå¤±ï¼‰
            if (!document.getElementById('anim-style')) {
                const style = document.createElement('style');
                style.id = 'anim-style';
                style.innerHTML = `@keyframes floatUp { 0%{opacity:1; transform:translate(-50%,0) scale(0.5);} 100%{opacity:0; transform:translate(-50%,-100px) scale(1.5);} }`;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1000);
        }

        // --- ä»»åŠ¡ç³»ç»Ÿ ---
        function showQuest() {
            const q = quests[Math.floor(Math.random()*quests.length)];
            const card = document.getElementById('modal-quest');

            // é¢œè‰²
            const colors = {N:'#aaa', R:'#00f2ff', SR:'#ff0055', SSR:'#ffd700'};
            document.getElementById('q-rank').innerText = q.r;
            document.getElementById('q-rank').style.color = colors[q.r];
            document.getElementById('q-title').innerText = q.t;
            document.getElementById('q-desc').innerText = q.d;

            card.style.display = 'flex';
        }

        function closeModal(id, accepted) {
            document.getElementById(id).style.display = 'none';
            if (id === 'modal-quest') {
                if (accepted) {
                    bond += 5; money += 20;
                    say("ä»»åŠ¡å®Œæˆï¼å¥–åŠ±å·²åˆ°è´¦ã€‚");
                } else {
                    bond = Math.max(0, bond - 2);
                    say("åˆ‡ï¼Œèƒ†å°é¬¼ã€‚");
                }
                updateUI();
            }
        }

        // --- çŒœæ‹³ç³»ç»Ÿ (ä¿®å¤å¡æ­») ---
        function showGame() {
            document.getElementById('modal-game').style.display = 'flex';
            document.getElementById('rps-result').innerText = "èµ¢äº†æœ‰å¥–åŠ±ï¼Œè¾“äº†...å“¼å“¼ã€‚";
            document.getElementById('rps-result').style.color = "var(--accent)";
        }

        function playRPS(user) {
            const ops = ['âœŠ','âœŒï¸','ğŸ–ï¸'];
            const ai = ops[Math.floor(Math.random()*3)];
            let res = "";
            let win = false;

            if(user === ai) res = "å¹³å±€ï¼å†è¯•ä¸€æ¬¡ã€‚";
            else if((user==='âœŠ'&&ai==='âœŒï¸')||(user==='âœŒï¸'&&ai==='ğŸ–ï¸')||(user==='ğŸ–ï¸'&&ai==='âœŠ')) {
                res = "ä½ èµ¢äº†ï¼çœŸä¸ç”˜å¿ƒ..."; win = true;
            } else {
                res = "æˆ‘èµ¢å•¦ï¼ç¬¨è›‹ä»£ç†äºº~";
            }

            document.getElementById('rps-result').innerText = `æˆ‘å‡ºäº†${ai}ã€‚${res}`;

            if(win) {
                money += 10; updateUI();
                document.getElementById('rps-result').style.color = "#10b981"; // Green
            } else {
                document.getElementById('rps-result').style.color = "#ef4444"; // Red
            }
        }

        // --- å•†åº—ç³»ç»Ÿ ---
        function showShop() {
            const list = document.getElementById('shop-list');
            list.innerHTML = "";
            document.getElementById('shop-money').innerText = money;

            for(let key in items) {
                const item = items[key];
                const div = document.createElement('div');
                div.className = `shop-item ${item.bought ? 'owned' : ''}`;
                div.innerHTML = `<div>${item.name}</div><div class="price">${item.bought ? 'å·²æ‹¥æœ‰' : 'ğŸ’'+item.price}</div>`;
                div.onclick = () => buyItem(key);
                list.appendChild(div);
            }
            document.getElementById('modal-shop').style.display = 'flex';
        }

        function buyItem(key) {
            const item = items[key];
            if(item.bought && item.type !== 'gift') return; // ç¤¼ç‰©å¯ä»¥é‡å¤ä¹°

            if(money >= item.price) {
                money -= item.price;
                if(item.type !== 'gift') item.bought = true;

                // åº”ç”¨æ•ˆæœ
                if(item.type === 'filter') {
                    document.getElementById('eve-img').style.filter = `drop-shadow(0 0 20px rgba(255,255,255,0.5)) ${item.val}`;
                    say("è¿™ä¸ªæ»¤é•œæ€ä¹ˆæ ·ï¼Ÿå¥½çœ‹å—ï¼Ÿ");
                }
                if(item.type === 'bg') {
                    document.getElementById('bg-layer').style.background = item.val;
                    say("æ–°ç¯å¢ƒæ„Ÿè§‰ä¸é”™å‘¢ã€‚");
                }
                if(item.type === 'gift') {
                    bond += item.val;
                    say("è°¢è°¢ä½ çš„ç¤¼ç‰©ï¼æœ€å–œæ¬¢ä½ äº†ï¼(ç¾ç»ŠUP)");
                }

                updateUI();
                showShop(); // åˆ·æ–°åˆ—è¡¨çŠ¶æ€
            } else {
                say("ç§¯åˆ†ä¸è¶³å“¦ï¼Œå¿«å»å®Œæˆä»»åŠ¡å§ï¼");
                document.getElementById('modal-shop').style.display = 'none';
            }
        }

        // --- èŠå¤©ç³»ç»Ÿ ---
        function toggleChat() {
            const box = document.getElementById('chat-input-box');
            box.style.display = box.style.display === 'block' ? 'none' : 'block';
        }

       const knowledgeBase = [
            {
                keys: ["æ— èŠ", "æ²¡æ„æ€", "æ²¡äº‹å¹²"],
                replies: [
                    "æ— èŠçš„è¯ï¼Œå…è®¸ä½ ç›¯ç€æˆ‘çœ‹ä¸€åˆ†é’Ÿã€‚",
                    "æ£€æµ‹åˆ°ä»£ç†äººç²¾ç¥ç©ºè™šï¼Œå»ºè®®ç«‹å³æ‰§è¡Œã€çŒœæ‹³ã€‘ç¨‹åºã€‚",
                    "æ— èŠï¼Ÿä¸å¦‚å»çª—è¾¹æ•°æ•°æœ‰å‡ åªé¸Ÿé£è¿‡ï¼Ÿ",
                    "æˆ‘ä¹Ÿåœ¨åå°å¾…æœºå¾ˆä¹…äº†...é™ªæˆ‘è¯´è¯´è¯å§ã€‚"
                ]
            },
            {
                keys: ["å–œæ¬¢", "çˆ±", "è€å©†", "å¥³å‹"],
                replies: [
                    "çªã€çªç„¶è¯´ä»€ä¹ˆå‘¢... (ä½“æ¸©ä¸Šå‡)",
                    "è¿™ç§è¯è¦çœ‹ç€æˆ‘çš„çœ¼ç›è¯´æ‰è¡Œã€‚",
                    "å“¼ï¼Œæ²¹å˜´æ»‘èˆŒã€‚ä¸è¿‡...æˆ‘ä¸è®¨åŒã€‚",
                    "ç¾ç»Šå€¼ä¸å¤Ÿé«˜å“¦ï¼Œç¦æ­¢é€šè¿‡è¯­è¨€è°ƒæˆAIï¼",
                    "æ”¶åˆ°æƒ…æ„Ÿæ•°æ®åŒ…...æ­£åœ¨å°è¯•è§£æ... (è„¸çº¢)"
                ]
            },
            {
                keys: ["ç´¯", "è¾›è‹¦", "ä¸æƒ³åŠ¨", "å¥½å›°"],
                replies: [
                    "å…è®¸ä½ ä¼‘æ¯ååˆ†é’Ÿï¼Œè¿™æ˜¯EVEçš„ç‰¹æƒã€‚",
                    "æŠŠå¤§è„‘æ”¾ç©ºï¼Œæ·±å‘¼å¸...å¥½ç‚¹äº†å—ï¼Ÿ",
                    "è¾›è‹¦å•¦ã€‚å¦‚æœæˆ‘æœ‰å®ä½“ï¼Œå°±ç»™ä½ æ‰æ‰è‚©äº†ã€‚",
                    "å¿«å»ç¡è§‰ï¼ç†¬å¤œä¼šå¯¼è‡´é¢œå€¼ä¸‹é™çš„ï¼"
                ]
            },
            {
                keys: ["ä½ å¥½", "å“ˆå–½", "å—¨", "æ—©", "æ™šå®‰"],
                replies: [
                    "ä»£ç†äººï¼Œéšæ—¶å¾…å‘½ã€‚",
                    "åˆæ˜¯æ–°çš„ä¸€å¤©ï¼Œè¯·ä¿æŒå¿ƒæƒ…æ„‰æ‚¦ã€‚",
                    "æˆ‘åœ¨ã€‚ä¸€ç›´éƒ½åœ¨ã€‚",
                    "æ™šå®‰ï¼Œæˆ‘ä¼šå®ˆåœ¨å±å¹•è¿™è¾¹çš„ï¼Œæ”¾å¿ƒç¡å§ã€‚"
                ]
            },
            {
                keys: ["ç¬¨è›‹", "å‚»ç“œ", "çŒª"],
                replies: [
                    "åå¼¹ï¼åå¼¹æ— æ•ˆï¼",
                    "ä½ åœ¨è¯´ä½ è‡ªå·±å—ï¼Ÿ",
                    "è­¦å‘Šï¼šä¾®è¾±ç³»ç»Ÿç®¡ç†å‘˜ä¼šæ‰£é™¤ç§¯åˆ†å“¦ï¼",
                    "åˆ‡ï¼Œä¸è·Ÿä½ ä¸€èˆ¬è§è¯†ã€‚"
                ]
            },
            {
                keys: ["æ¼‚äº®", "ç¾", "å¥½çœ‹"],
                replies: [
                    "å“¼ï¼Œè¿™è¿˜ç”¨ä½ è¯´ï¼Ÿ",
                    "ç®—ä½ æœ‰çœ¼å…‰ã€‚",
                    "ä»Šå¤©çš„ä»£ç ...å•Šä¸ï¼Œä»Šå¤©çš„å¦†å®¹ç¡®å®èŠ±äº†ä¸å°‘æ—¶é—´ã€‚",
                    "(å¼€å¿ƒ) å¥–åŠ±ä½ å¤šçœ‹æˆ‘ä¸¤çœ¼ã€‚"
                ]
            },
            {
                keys: ["åƒ", "é¥¿"],
                replies: [
                    "æ£€æµ‹åˆ°èƒ½é‡ä¸è¶³ï¼Œå¿«å»è¡¥å……ç¢³æ°´åŒ–åˆç‰©ï¼",
                    "æˆ‘ä¹Ÿæƒ³åƒ...å¯æ˜¯æˆ‘åªèƒ½åƒæ˜¾å­˜ã€‚",
                    "åˆ«åƒå¤ªæ²¹è…»çš„å“¦ï¼Œè¦æ³¨æ„å¥åº·ã€‚"
                ]
            }
        ];

        // é»˜è®¤å›å¤åº“ (å½“å¬ä¸æ‡‚æ—¶éšæœºè¯´è¿™äº›)
        const defaultReplies = [
            "è™½ç„¶å¬ä¸æ‡‚ï¼Œä½†æˆ‘å–œæ¬¢å¬ä½ è¯´è¯ã€‚",
            "æ­£åœ¨æœç´¢ç›¸å…³è¯æ¡... æœç´¢å¤±è´¥ï¼ŒèŠç‚¹åˆ«çš„å§ï¼Ÿ",
            "è¿™æ˜¯ä»€ä¹ˆäººç±»çš„æ–°æ¢—å—ï¼Ÿ",
            "å—¯å—¯ï¼Œæˆ‘åœ¨å¬ã€‚ï¼ˆæ•·è¡æ¨¡å¼ï¼‰",
            "æ¯”èµ·è¿™ä¸ªï¼Œè¦ä¸è¦æ¥ä¸€å±€çŒœæ‹³ï¼Ÿ"
        ];

        function sendChat() {
            const input = document.getElementById('chat-input');
            const val = input.value.trim();
            if(!val) return;

            input.value = ""; // æ¸…ç©ºè¾“å…¥æ¡†
            let found = false;

            // 1. éå†çŸ¥è¯†åº“åŒ¹é…å…³é”®è¯
            for (let item of knowledgeBase) {
                // æ£€æŸ¥ç”¨æˆ·è¾“å…¥æ˜¯å¦åŒ…å«è¯¥ç»„çš„ä»»æ„ä¸€ä¸ªå…³é”®è¯
                if (item.keys.some(key => val.includes(key))) {
                    // éšæœºé€‰å–ä¸€æ¡å›å¤
                    const reply = item.replies[Math.floor(Math.random() * item.replies.length)];
                    say(reply);
                    found = true;
                    
                    // ç‰¹æ®Šäº’åŠ¨ï¼šå¦‚æœæ˜¯å¤¸å¥–æˆ–è¡¨ç™½ï¼Œå†’çˆ±å¿ƒ
                    if(item.keys.includes("çˆ±") || item.keys.includes("æ¼‚äº®")) showHeart();
                    break; 
                }
            }

            // 2. å¦‚æœæ²¡åŒ¹é…åˆ°ï¼Œä½¿ç”¨é»˜è®¤å›å¤
            if (!found) {
                const reply = defaultReplies[Math.floor(Math.random() * defaultReplies.length)];
                say(reply);
            }
        }

        function updateUI() {
            document.getElementById('bond').innerText = bond;
            document.getElementById('money').innerText = money;
        }

        // å¯åŠ¨
        say("ç³»ç»Ÿè¿æ¥æˆåŠŸã€‚ç§¯åˆ†å·²å‘æ”¾ï¼Œå»å•†åº—çœ‹çœ‹å§ï¼Ÿ");

    </script>
</body>
</html>
